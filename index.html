<html>
  <head>
    <style>
      .chart {
        height: 500px;
        width: 300px;
        border-radius: 10px;
        background-color: #292929;
        display: flex;
        flex-direction: column;
      }
      .abs {
        position: absolute;
        right: 0;
        bottom: 0;
      }
    </style>
  </head>
  <body style="background-color: #424242">
    <div style="display: flex; flex-direction: row; height: 100%">
      <iframe
        style="flex: 2"
        src="https://niftychain.in/"
        frameborder="0"
      ></iframe>
      <div style="flex: 0.8; height: 100%" class="chart">
        <canvas id="myChart"></canvas>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      const ctx = document.getElementById("myChart");

      const data = {
        labels: [2, "4311", "4571", "4588"],
        datasets: [
          {
            data: [5996, 4605, 1288, 3463, 5996, 4605, 1288, 3463],
            backgroundColor: [
              "rgba(245, 48, 32, 0.55)",
              "rgba(37, 255, 32, 0.55)",
              "rgba(245, 48, 32, 0.55)",
              "rgba(37, 255, 32, 0.55)",
              "rgba(245, 48, 32, 0.55)",
              "rgba(37, 255, 32, 0.55)",
              "rgba(245, 48, 32, 0.55)",
              "rgba(37, 255, 32, 0.55)",
            ],
            borderColor: [
              "rgba(245, 48, 32, 0.8)",
              "rgba(37, 255, 32, 0.55)",
              "rgba(245, 48, 32, 0.8)",
              "rgba(37, 255, 32, 0.55)",
              "rgba(245, 48, 32, 0.8)",
              "rgba(37, 255, 32, 0.55)",
              "rgba(245, 48, 32, 0.8)",
              "rgba(37, 255, 32, 0.55)",
            ],
          },
        ],
      };

      Chart.defaults.color = "white";
      let myChart = new Chart(ctx, {
        type: "bar",
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
            },
          },
          tooltips: {
            callbacks: {
              label: (tooltipItem, data) => {
                let i = tooltipItem.index;
                return data.productNames[i] + ": " + data.datasets[0].data[i];
              },
            },
          },
        },
        data: data,
      });

      function setOi() {
        fetch("https://api.niftychain.in/api/live-data", {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8",
          },
          body: "ticker=NIFTY",
        }).then(async (data) => {
          let hehe = await data.json();
          let stkprice = Math.round(hehe.data.underlyingValue / 50) * 50;

          for (x in hehe.data.data) {
            if (hehe.data.data[x].strikePrice == stkprice)
              addData(
                myChart,
                [
                  hehe.data.data[x - 1].ce.openInterest,
                  hehe.data.data[x - 1].pe.openInterest,
                  hehe.data.data[x].ce.openInterest,
                  hehe.data.data[x].pe.openInterest,
                ],
                [
                  hehe.data.data[x - 1].strikePrice,
                  hehe.data.data[x - 1].strikePrice,
                  hehe.data.data[x].strikePrice,
                  hehe.data.data[x].strikePrice,
                ],
                0
              );
          }
        });
      }
      setOi();
      setInterval(() => setOi(), 10000);

      function addData(chart, data, labels, datasetIndex) {
        chart.data.datasets[datasetIndex].data = data;
        chart.data.labels = labels;
        chart.update();
      }
    </script>
  </body>
</html>
